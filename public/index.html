<head>
	<link rel="stylesheet" type="text/css" href="assets/main.css">
	<!-- Angular Material style sheet -->
     <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css">

	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-resource.min.js"></script>

	        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-animate.min.js"></script>
	        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-aria.min.js"></script>

	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-route.min.js"></script>
	<!-- Angular Material Library -->
<script src="//ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.js"></script>

<!--
	<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff"> -->

	<!-- External libs -->
	<!-- future remove -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="https://www.google.com/jsapi"></script>
	 <base href="/">
</head>
<body  ng-app="pluviamApp"  ng-cloak>
<div >
	<div layout="column" layout-fill>
		<md-toolbar>
			<div class="md-toolbar-tools">
				<a href="http://pluvi.am" >
					<img src="/images/pluviam_menu_logo.png"/>
				</a>

				<h1 class="md-title">
					pluviam
				</h1>

				<!-- fill up the space between left and right area -->
				<span flex></span>

				<div class="md-subhead">
					<p>
						<a href="http://goo.gl/forms/y4KIgseSPn">
							Contato
						</a>
						<a href="http://pluvi.am/about">
							Sobre
						</a>
					</p>
				</div>

			</div>
		</md-toolbar>

	    <div ng-view></div>



		<md-toolbar>
			<div layout="row">
				<div flex layout-margin></div>
				<div flex layout-margin><p class="md-caption">Pluviam | Saulo Matte Madalozzo ME | hello@pluvi.am</p></div>
			</div>
      	</md-toolbar>
	</div>
</div>
	<script>
	//angular


	'use strict';
var isGoogleChartReady = false;
/* Controllers */
google.load('visualization', '1', {
  packages: ['corechart']
});

google.setOnLoadCallback(function() {
	isGoogleChartReady =  true;
});
 var pluviamApp = angular.module('pluviamApp', ['ngRoute','ngMaterial']);

pluviamApp.config(function($mdThemingProvider) {
  $mdThemingProvider.theme('default')
    .primaryPalette('blue')
    .accentPalette('indigo');
});

pluviamApp.config(['$routeProvider', '$locationProvider',
  function($routeProvider, $locationProvider) {
    $routeProvider.
	when('/', {
	  templateUrl: 'home.html',
	  controller: 'mainController'
  }).
      when('/about', {
        templateUrl: 'about.html',
        controller: 'aboutController'
    }).
     when('/:country/:county/:city/:station', {
        templateUrl: 'stations.html',
        controller: 'StationsController'
	}).
      otherwise({
        redirectTo: '/'
      });
	 $locationProvider.html5Mode(true);
}]);


// create the controller and inject Angular's $scope
pluviamApp.controller('mainController', function($scope) {
	$scope.message = 'Everyone come and see how good I look!';
});

pluviamApp.controller('aboutController', function($scope) {
	$scope.message = 'Look! I am an about page.';
});


pluviamApp.controller('StationsController', ['$scope','$http',
function($scope, $http) {
	  $http.get('//local.api.pluvi.am/stations/5733d44918fd93b0d0d999af').
	    success(function(results, status, headers, config) {
			$scope.weather = results.weather[results.weather.length-1];
			$scope.station = results.station;

	    	//console.log("its ready?");
	    	//while (!isGoogleChartReady){
	    	//	console.log("notready");
	    	//}
	    	if (isGoogleChartReady){
	    	console.log("ready");

			var loader = document.getElementById('indeterminateLoader');
			var graphsDisplay =  document.getElementById('graphsBase');
			//invert for each
			$.each(results.station.inputs, function (i, row) {
				if (row.chartType !== 'none'){
					var dimension = row.name;
					console.log(dimension);
					var plotTogether = false;
					var rowPlotTogether = '';
					if(row.plotTogether !== ''){
						plotTogether = row.plotTogether;
						$.each(results.station.inputs, function (j, row2) {
							if (row2.name === plotTogether){
								rowPlotTogether = row2;
								console.log(rowPlotTogether);
							}
						});
					}
					graphsDisplay.insertAdjacentHTML('beforebegin', '<div flex id="' + dimension + '" style="width: 100%;"></div>');
					var dimensionData = new google.visualization.DataTable();
					dimensionData.addColumn('datetime', 'Data/Hora');
					dimensionData.addColumn('number', row.shortName);
					if (plotTogether){
						console.log('added dimension data layer');
						dimensionData.addColumn('number', rowPlotTogether.shortName);
					}

					if (plotTogether){
						$.each(results.weather, function (i, row) {
								dimensionData.addRow([(new Date(row.date)),parseFloat(row[dimension]),parseFloat(row[rowPlotTogether.name])]);
						});
					}else{
						$.each(results.weather, function (i, row) {
							dimensionData.addRow([(new Date(row.date)),parseFloat(row[dimension])]);
						});
					}
					if (row.chartType === 'LineChart'){
						drawChart(new google.visualization.LineChart(document.getElementById(dimension)),  row.chartColors, row.shortName + ' - ' + row.unit, dimensionData);
					}else if (row.chartType === 'ColumnChart'){
						drawChart(new google.visualization.ColumnChart(document.getElementById(dimension)), row.chartColors, row.shortName + ' - ' + row.unit, dimensionData);
					}else if (row.chartType === 'AreaChart'){
						drawChart(new google.visualization.AreaChart(document.getElementById(dimension)), row.chartColors, row.shortName + ' - ' + row.unit, dimensionData);
					}

				}
			});
			loader.style.display = 'none';

	    	}
	    }).
	    error(function(data, status, headers, config) {
	      // log error
	      console.log("fail");
	    });

     }

]);

    function drawChart(chart, color, title, data){
        var options = {
    		    hAxis: {
    		        format: 'HH:mm'
    		    },
			colors:color,
			legend: {position: 'none'},
			height: 300,
			title: title,
			vAxis: {minValue: 0},
			isStacked: false
    		};
        chart.draw(data, options);
    }

  </script>

</body>
