"use strict"
function drawChart(chart,color,title,data,height){var options={hAxis:{format:"HH:mm"},colors:color,legend:{position:"none"},height:height,backgroundColor:"#FAFAFA",title:title,isStacked:!1}
chart.draw(data,options)}function PhotosController($scope,$rootScope,$mdDialog){$scope.station=$rootScope.station,$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)}}function InfoController($scope,$rootScope,$mdDialog){$scope.station=$rootScope.station,$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)}}!function(){angular.module("angulike",[]).directive("fbLike",["$window","$rootScope",function($window,$rootScope){return{restrict:"A",scope:{fbLike:"=?"},link:function(scope,element,attrs){function renderLikeButton(){if(!attrs.fbLike||scope.fbLike||watchAdded)element.html('<div class="fb-like"'+(scope.fbLike?' data-href="'+scope.fbLike+'"':"")+' data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>'),$window.FB.XFBML.parse(element.parent()[0])
else{watchAdded=!0
var unbindWatch=scope.$watch("fbLike",function(newValue,oldValue){newValue&&(renderLikeButton(),unbindWatch())})}}$window.FB?renderLikeButton():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){$window.FB.init({appId:742272115829511,xfbml:!0,version:"v2.0"}),renderLikeButton()})
var watchAdded=!1}}}]).directive("googlePlus",["$window",function($window){return{restrict:"A",scope:{googlePlus:"=?"},link:function(scope,element,attrs){function renderPlusButton(){if(!attrs.googlePlus||scope.googlePlus||watchAdded)element.html('<div class="g-plusone"'+(scope.googlePlus?' data-href="'+scope.googlePlus+'"':"")+' data-size="medium"></div>'),$window.gapi.plusone.go(element.parent()[0])
else{watchAdded=!0
var unbindWatch=scope.$watch("googlePlus",function(newValue,oldValue){newValue&&(renderPlusButton(),unbindWatch())})}}$window.gapi?renderPlusButton():$.getScript("//apis.google.com/js/platform.js",function(){renderPlusButton()})
var watchAdded=!1}}}]).directive("tweet",["$window","$location",function($window,$location){return{restrict:"A",scope:{tweet:"=",tweetUrl:"="},link:function(scope,element,attrs){function renderTweetButton(){if(scope.tweet||watchAdded)element.html('<a href="https://twitter.com/share" class="twitter-share-button" data-text="'+scope.tweet+'" data-url="'+(scope.tweetUrl||$location.absUrl())+'">Tweet</a>'),$window.twttr.widgets.load(element.parent()[0])
else{watchAdded=!0
var unbindWatch=scope.$watch("tweet",function(newValue,oldValue){newValue&&(renderTweetButton(),unbindWatch())})}}$window.twttr?renderTweetButton():$.getScript("//platform.twitter.com/widgets.js",function(){renderTweetButton()})
var watchAdded=!1}}}]).directive("pinIt",["$window","$location",function($window,$location){return{restrict:"A",scope:{pinIt:"=",pinItImage:"=",pinItUrl:"="},link:function(scope,element,attrs){function renderPinItButton(){if(scope.pinIt||watchAdded)element.html('<a href="//www.pinterest.com/pin/create/button/?url='+(scope.pinItUrl||$location.absUrl())+"&media="+scope.pinItImage+"&description="+scope.pinIt+'" data-pin-do="buttonPin" data-pin-config="beside"></a>'),$window.parsePins(element.parent()[0])
else{watchAdded=!0
var unbindWatch=scope.$watch("pinIt",function(newValue,oldValue){newValue&&(renderPinItButton(),unbindWatch())})}}$window.parsePins?renderPinItButton():!function(d){var f=d.getElementsByTagName("SCRIPT")[0],p=d.createElement("SCRIPT")
p.type="text/javascript",p.async=!0,p.src="//assets.pinterest.com/js/pinit.js",p["data-pin-build"]="parsePins",p.onload=function(){$window.parsePins?renderPinItButton():setTimeout(p.onload,100)},f.parentNode.insertBefore(p,f)}($window.document)
var watchAdded=!1}}}])}()
var pluviamApp=angular.module("pluviamApp",["ngRoute","ngMaterial","angulike"])
pluviamApp.config(function($mdThemingProvider){$mdThemingProvider.theme("default").primaryPalette("blue").accentPalette("indigo")}),pluviamApp.config(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!1)}]),pluviamApp.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"home.html",controller:"mainController"}).when("/about",{templateUrl:"about.html",controller:"aboutController"}).when("/:country/:county/:city/:stationName",{templateUrl:"stations.html",controller:"StationsController"}).otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}]),pluviamApp.controller("mainController",function($scope){$scope.message="main!"}),pluviamApp.controller("aboutController",function($scope){$scope.message="Nada aqui, ainda"}),pluviamApp.controller("StationsController",["$scope","$rootScope","$http","$routeParams","$mdDialog","$mdMedia",function($scope,$rootScope,$http,$routeParams,$mdDialog,$mdMedia){var API_URL_BASE="//api.pluvi.am",stationId="",paramCountry=$routeParams.country.toLowerCase(),paramCounty=$routeParams.county.toLowerCase(),paramCity=$routeParams.city.toLowerCase(),paramStationName=$routeParams.stationName.toLowerCase()
$http.get(API_URL_BASE+"/stations/").success(function(results,status,headers,config){angular.forEach(results.stations,function(row,i){paramCountry===row.location.countryCode.toLowerCase()&&paramCounty===row.location.countyCode.toLowerCase()&&paramCity===row.location.urlCity.toLowerCase()&&paramStationName===row.urlName.toLowerCase()&&(stationId=row.id,$http.get(API_URL_BASE+"/stations/"+stationId).success(function(results,status,headers,config){$scope.weather=results.weather[results.weather.length-1],$scope.station=results.station,$rootScope.station=results.station,$rootScope.seo={pageTitle:"pluviam - "+results.station.fullName,canonicalUrl:"http://pluvi.am/"+results.station.location.countryCode.toLowerCase()+"/"+results.station.location.countyCode.toLowerCase()+"/"+results.station.location.urlCity+"/"+results.station.urlName,name:results.station.fullName+" - Estação meteorológica Pluviam"}
var loader=document.getElementById("indeterminateLoader"),graphsDisplay=document.getElementById("graphsBase")
angular.forEach(results.station.inputs,function(row,i){if("none"!==row.chartType){var dimension=row.name,plotTogether=!1,rowPlotTogether=""
""!==row.plotTogether&&(plotTogether=row.plotTogether,angular.forEach(results.station.inputs,function(row2,j){row2.name===plotTogether&&(rowPlotTogether=row2)})),graphsDisplay.insertAdjacentHTML("beforebegin",'<div flex id="'+dimension+'"></div>')
var dimensionData=new google.visualization.DataTable
if(dimensionData.addColumn("datetime","Data/Hora"),dimensionData.addColumn("number",row.shortName),plotTogether&&dimensionData.addColumn("number",rowPlotTogether.shortName),plotTogether)angular.forEach(results.weather,function(row,i){dimensionData.addRow([new Date(row.date),parseFloat(row[dimension]),parseFloat(row[rowPlotTogether.name])])})
else if(row.cumulative){var dimensionValue,dimensionDateDay,cumulate=0,lastDimensionDate=results.weather[results.weather.length-1].date,lastDimensionDateDay=new Date(lastDimensionDate).getDate()
angular.forEach(results.weather,function(row,i){dimensionDateDay=new Date(row.date).getDate(),dimensionValue=parseFloat(row[dimension]),dimensionData.addRow([new Date(row.date),dimensionValue]),dimensionDateDay===lastDimensionDateDay&&(cumulate+=dimensionValue)}),$scope.weather[dimension]=cumulate}else angular.forEach(results.weather,function(row,i){dimensionData.addRow([new Date(row.date),parseFloat(row[dimension])])})
var chartHeigth=$mdMedia("sm")||$mdMedia("xs")?250:400
"LineChart"===row.chartType?drawChart(new google.visualization.LineChart(document.getElementById(dimension)),row.chartColors,row.shortName+" - "+row.unit,dimensionData,chartHeigth):"ColumnChart"===row.chartType?drawChart(new google.visualization.ColumnChart(document.getElementById(dimension)),row.chartColors,row.shortName+" - "+row.unit,dimensionData,chartHeigth):"AreaChart"===row.chartType&&drawChart(new google.visualization.AreaChart(document.getElementById(dimension)),row.chartColors,row.shortName+" - "+row.unit,dimensionData,chartHeigth)}}),loader.style.display="none"}).error(function(data,status,headers,config){console.log("fail")}))})}).error(function(data,status,headers,config){console.log("fail")}),$scope.showPhotos=function(event){var useFullScreen=($mdMedia("sm")||$mdMedia("xs"))&&$scope.customFullscreen
$mdDialog.show({controller:PhotosController,templateUrl:"photos.html",parent:angular.element(document.body),targetEvent:event,clickOutsideToClose:!0,fullscreen:useFullScreen}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."}),$scope.$watch(function(){return $mdMedia("xs")||$mdMedia("sm")},function(wantsFullScreen){$scope.customFullscreen=!0})},$scope.showInfos=function(event){var useFullScreen=($mdMedia("sm")||$mdMedia("xs"))&&$scope.customFullscreen
$mdDialog.show({controller:InfoController,templateUrl:"infos.html",parent:angular.element(document.body),targetEvent:event,clickOutsideToClose:!0,fullscreen:useFullScreen}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."}),$scope.$watch(function(){return $mdMedia("xs")||$mdMedia("sm")},function(wantsFullScreen){$scope.customFullscreen=!0})}}])
